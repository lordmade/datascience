<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CETA Learner Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    .sidebar {
      transition: transform 0.3s ease, width 0.3s ease;
      transform: translateX(0);
    }
    .sidebar-hidden {
      transform: translateX(-100%);
      width: 0;
    }
    .main-content {
      transition: margin-left 0.3s ease;
    }
    .dark-mode {
      background: #1f2937;
      color: #f3f4f6;
    }
    .dark-mode .bg-white {
      background: #374151;
    }
    .dark-mode .bg-gray-50 {
      background: #4b5563;
    }
    .dark-mode .text-gray-600 {
      color: #d1d5db;
    }
    .tooltip {
      position: relative;
    }
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 10;
    }
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        z-index: 50;
        width: 256px;
        transform: translateX(-100%);
      }
      .sidebar-open {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans min-h-screen transition-colors duration-300">
  <div class="flex">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar bg-gradient-to-b from-gray-800 to-gray-900 text-white w-64 min-h-screen p-4 shadow-lg">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold flex items-center gap-2">
          <i class="fas fa-graduation-cap"></i> CETA Learner
        </h1>
        <button id="toggle-sidebar" class="md:hidden text-white focus:outline-none" aria-label="Toggle sidebar">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
      <nav>
        <ul class="space-y-2">
          <li><button class="nav-button w-full text-left p-2 hover:bg-gray-700 rounded flex items-center gap-2" data-section="overview" data-tooltip="Dashboard Overview"><i class="fas fa-tachometer-alt"></i> Overview</button></li>
          <li><button class="nav-button w-full text-left p-2 hover:bg-gray-700 rounded flex items-center gap-2" data-section="courses" data-tooltip="View Programs"><i class="fas fa-book"></i> My Programs</button></li>
          <li><button class="nav-button w-full text-left p-2 hover:bg-gray-700 rounded flex items-center gap-2" data-section="assessments" data-tooltip="View Assessments"><i class="fas fa-tasks"></i> Assessments</button></li>
          <li><button class="nav-button w-full text-left p-2 hover:bg-gray-700 rounded flex items-center gap-2" data-section="certifications" data-tooltip="View Certificates"><i class="fas fa-certificate"></i> Certificates</button></li>
          <li><button class="nav-button w-full text-left p-2 hover:bg-gray-700 rounded flex items-center gap-2" data-section="notices" data-tooltip="Notice Board"><i class="fas fa-bell"></i> Notices</button></li>
          <li><button class="nav-button w-full text-left p-2 hover:bg-gray-700 rounded flex items-center gap-2" data-section="helpdesk" data-tooltip="Submit Helpdesk Ticket"><i class="fas fa-headset"></i> Helpdesk</button></li>
        </ul>
      </nav>
      <div class="mt-auto">
        <button id="toggle-dark-mode" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded mb-2" aria-label="Toggle dark mode">Toggle Dark Mode</button>
        <button id="signout-btn" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded" aria-label="Sign out">Sign Out</button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content flex-1 p-6 md:ml-64">
      <!-- Notifications -->
      <div id="notifications" class="mb-4 hidden">
        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded shadow">
          <h3 class="text-lg font-semibold">Notifications</h3>
          <ul id="notification-list" class="space-y-2"></ul>
        </div>
      </div>

      <!-- Overview Section -->
      <div id="overview" class="section">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2"><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
        <div class="grid gap-6 md:grid-cols-3">
          <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
            <h3 class="text-lg font-semibold">Enrolled Programs</h3>
            <p id="total-courses" class="text-4xl font-bold text-indigo-600">0</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
            <h3 class="text-lg font-semibold">Progress</h3>
            <p id="learner-progress" class="text-4xl font-bold text-indigo-600">0%</p>
          </div>
          <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-shadow">
            <h3 class="text-lg font-semibold">Certificates Earned</h3>
            <p id="total-certificates" class="text-4xl font-bold text-indigo-600">0</p>
          </div>
        </div>
        <div class="mt-6 bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">Course Progress</h3>
          <canvas id="progress-chart" class="w-full h-64"></canvas>
        </div>
        <div class="mt-6 bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">Recent Notices</h3>
          <div id="recent-notices" class="space-y-4"></div>
        </div>
      </div>

      <!-- My Programs Section -->
      <div id="courses" class="section hidden">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2"><i class="fas fa-book"></i> My Programs</h2>
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">Enrolled Programs</h3>
          <input type="text" id="courseSearch" placeholder="Search programs..." class="border p-2 rounded w-full mb-4" aria-label="Search programs by name or tag" />
          <div id="courseList" class="space-y-4"></div>
        </div>
      </div>

      <!-- Assessments Section -->
      <div id="assessments" class="section hidden">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2"><i class="fas fa-tasks"></i> Assessments</h2>
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">My Assessments</h3>
          <div id="assessmentList" class="space-y-4"></div>
        </div>
      </div>

      <!-- Certificates Section -->
      <div id="certifications" class="section hidden">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2"><i class="fas fa-certificate"></i> My Certificates</h2>
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">Certificates</h3>
          <div id="certificationList" class="space-y-4"></div>
        </div>
      </div>

      <!-- Notices Section -->
      <div id="notices" class="section hidden">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2"><i class="fas fa-bell"></i> Notice Board</h2>
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">Notices</h3>
          <input type="text" id="noticeSearch" placeholder="Search notices..." class="border p-2 rounded w-full mb-4" aria-label="Search notices by title" />
          <div id="noticeList" class="space-y-4" aria-live="polite"></div>
        </div>
      </div>

      <!-- Helpdesk Section -->
      <div id="helpdesk" class="section hidden">
        <h2 class="text-3xl font-bold mb-6 flex items-center gap-2"><i class="fas fa-headset"></i> Helpdesk</h2>
        <div class="mb-6 bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">Submit Ticket</h3>
          <div class="flex flex-wrap gap-4 mb-4">
            <input type="text" id="ticketIssue" placeholder="Issue Description" class="border p-2 rounded flex-1 min-w-[200px]" aria-label="Enter issue description" />
            <select id="ticketPriority" class="border p-2 rounded min-w-[150px]" aria-label="Select priority">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
            <button onclick="submitTicket()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" data-tooltip="Submit ticket">Submit Ticket</button>
          </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h3 class="text-lg font-semibold mb-2">My Tickets</h3>
          <div id="ticketList" class="space-y-4"></div>
        </div>
      </div>

      <div id="loading-spinner" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-indigo-600"></div>
      </div>

      <noscript>
        <p class="text-red-600 text-center">JavaScript is required to use this dashboard.</p>
      </noscript>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getDatabase, ref, onValue, push, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.appspot.com",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    // DOM elements
    const courseList = document.getElementById("courseList");
    const courseSearch = document.getElementById("courseSearch");
    const assessmentList = document.getElementById("assessmentList");
    const certificationList = document.getElementById("certificationList");
    const noticeList = document.getElementById("noticeList");
    const noticeSearch = document.getElementById("noticeSearch");
    const ticketList = document.getElementById("ticketList");
    const totalCourses = document.getElementById("total-courses");
    const learnerProgress = document.getElementById("learner-progress");
    const totalCertificates = document.getElementById("total-certificates");
    const recentNotices = document.getElementById("recent-notices");
    const progressChartCanvas = document.getElementById("progress-chart");
    const loadingSpinner = document.getElementById("loading-spinner");
    const sidebar = document.getElementById("sidebar");
    const toggleSidebar = document.getElementById("toggle-sidebar");
    const toggleDarkMode = document.getElementById("toggle-dark-mode");
    const notifications = document.getElementById("notifications");
    const notificationList = document.getElementById("notification-list");

    let userData = {}, courses = {}, assessments = {}, certifications = {}, notices = {}, tickets = {};
    let currentUserId = null;

    // Show/hide loading spinner
    function showSpinner() { loadingSpinner.classList.remove("hidden"); }
    function hideSpinner() { loadingSpinner.classList.add("hidden"); }

    // Sidebar toggle
    toggleSidebar.addEventListener("click", () => {
      sidebar.classList.toggle("sidebar-hidden");
      sidebar.classList.toggle("sidebar-open");
    });

    // Dark mode toggle
    toggleDarkMode.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
    });

    // Load dark mode preference
    if (localStorage.getItem("darkMode") === "true") {
      document.body.classList.add("dark-mode");
    }

    // Section switching
    document.querySelectorAll(".nav-button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".section").forEach(section => section.classList.add("hidden"));
        document.getElementById(btn.dataset.section).classList.remove("hidden");
        if (window.innerWidth < 768) sidebar.classList.remove("sidebar-open");
        logAudit(`Viewed ${btn.dataset.section} section`);
      });
    });

    // Debounce function for search
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // Load notifications
    function loadNotifications() {
      onValue(ref(db, "audit_logs"), snap => {
        notificationList.innerHTML = "";
        const data = snap.val() || {};
        const recentLogs = Object.entries(data)
          .filter(([_, log]) => log.userId === currentUserId)
          .sort((a, b) => b[1].timestamp - a[1].timestamp)
          .slice(0, 5);
        if (recentLogs.length > 0) {
          notifications.classList.remove("hidden");
        }
        recentLogs.forEach(([_, log]) => {
          const item = document.createElement("li");
          item.className = "text-sm";
          item.innerHTML = `<i class="fas fa-bell mr-2"></i> ${log.action} at ${new Date(log.timestamp).toLocaleString()}`;
          notificationList.appendChild(item);
        });
      });
    }

    // Load overview
    async function loadOverview() {
      showSpinner();
      const userSnap = await get(ref(db, `users/${currentUserId}`));
      userData = userSnap.val() || {};
      learnerProgress.textContent = `${userData.progress || 0}%`;

      onValue(ref(db, "courses"), snap => {
        courses = snap.val() || {};
        const enrolled = Object.keys(courses).filter(id => userData.enrolledCourses?.includes(id));
        totalCourses.textContent = enrolled.length;

        // Progress chart
        const progressData = enrolled.map(id => ({
          name: courses[id].name,
          progress: userData.courseProgress?.[id] || 0
        }));
        new Chart(progressChartCanvas, {
          type: "bar",
          data: {
            labels: progressData.map(p => p.name),
            datasets: [{
              label: "Progress (%)",
              data: progressData.map(p => p.progress),
              backgroundColor: "#2563eb",
              borderRadius: 4
            }]
          },
          options: {
            scales: { y: { beginAtZero: true, max: 100 } },
            plugins: { legend: { display: true } }
          }
        });
      });

      onValue(ref(db, "certifications"), snap => {
        certifications = snap.val() || {};
        const userCerts = Object.values(certifications).filter(c => c.learnerId === currentUserId);
        totalCertificates.textContent = userCerts.length;
      });

      onValue(ref(db, "notices"), snap => {
        recentNotices.innerHTML = "";
        const data = snap.val();
        if (!data) {
          recentNotices.innerHTML = "<p class='text-gray-600'>No recent notices.</p>";
          hideSpinner();
          return;
        }
        const recent = Object.entries(data)
          .sort((a, b) => b[1].createdAt - a[1].createdAt)
          .slice(0, 3);
        recent.forEach(([_, notice]) => {
          const noticeItem = document.createElement("div");
          noticeItem.className = "bg-gray-50 p-4 rounded-lg shadow hover:shadow-md transition-shadow";
          noticeItem.innerHTML = `
            <h4 class="text-md font-semibold">${notice.title}</h4>
            <p class="text-gray-700">${notice.content.substring(0, 100)}${notice.content.length > 100 ? "..." : ""}</p>
            <p class="text-sm text-gray-500 mt-2">Posted on ${new Date(notice.createdAt).toLocaleDateString()}</p>
          `;
          recentNotices.appendChild(noticeItem);
        });
        hideSpinner();
      });
    }

    // Load enrolled courses
    function loadCourses(filter = "") {
      showSpinner();
      onValue(ref(db, "courses"), snap => {
        courses = snap.val() || {};
        courseList.innerHTML = "";
        const enrolled = Object.keys(courses).filter(id => userData.enrolledCourses?.includes(id));
        enrolled.forEach(id => {
          const c = courses[id];
          if (c.name.toLowerCase().includes(filter.toLowerCase()) || c.metadata?.tags?.some(t => t.toLowerCase().includes(filter.toLowerCase()))) {
            const courseItem = document.createElement("div");
            courseItem.className = "bg-gray-50 p-4 rounded-lg shadow hover:shadow-md transition-shadow flex justify-between items-center";
            courseItem.innerHTML = `
              <div>
                <p class="font-semibold">${c.name}</p>
                <p class="text-sm text-gray-600">Tags: ${c.metadata?.tags?.join(", ") || "-"} | Progress: ${userData.courseProgress?.[id] || 0}%</p>
              </div>
              <div>
                <button onclick="viewCourse('${id}')" class="text-blue-600 hover:underline" aria-label="View program ${c.name}" data-tooltip="View program">View</button>
              </div>
            `;
            courseList.appendChild(courseItem);
          }
        });
        hideSpinner();
      });
    }

    // Load assessments
    function loadAssessments() {
      showSpinner();
      onValue(ref(db, "assessments"), snap => {
        assessments = snap.val() || {};
        assessmentList.innerHTML = "";
        for (const id in assessments) {
          const a = assessments[id];
          if (userData.enrolledCourses?.includes(a.courseId) && !a.archived) {
            const assessmentItem = document.createElement("div");
            assessmentItem.className = "bg-gray-50 p-4 rounded-lg shadow hover:shadow-md transition-shadow flex justify-between items-center";
            assessmentItem.innerHTML = `
              <div>
                <p class="font-semibold">${a.title}</p>
                <p class="text-sm text-gray-600">Course: ${courses[a.courseId]?.name || "-"}</p>
              </div>
              <div>
                <button onclick="viewAssessment('${id}')" class="text-blue-600 hover:underline" aria-label="View assessment ${a.title}" data-tooltip="View assessment">View</button>
              </div>
            `;
            assessmentList.appendChild(assessmentItem);
          }
        }
        hideSpinner();
      });
    }

    // Load certifications
    function loadCertifications() {
      showSpinner();
      onValue(ref(db, "certifications"), snap => {
        certifications = snap.val() || {};
        certificationList.innerHTML = "";
        for (const id in certifications) {
          const c = certifications[id];
          if (c.learnerId === currentUserId) {
            const certItem = document.createElement("div");
            certItem.className = "bg-gray-50 p-4 rounded-lg shadow hover:shadow-md transition-shadow flex justify-between items-center";
            certItem.innerHTML = `
              <div>
                <p class="font-semibold">${c.template}</p>
                <p class="text-sm text-gray-600">Course: ${courses[c.courseId]?.name || "-"} | Issued: ${new Date(c.issuedAt).toLocaleDateString()}</p>
              </div>
              <div>
                <button onclick="viewCertificate('${id}')" class="text-blue-600 hover:underline" aria-label="View certificate" data-tooltip="View certificate">View</button>
              </div>
            `;
            certificationList.appendChild(certItem);
          }
        }
        hideSpinner();
      });
    }

    // Load notices
    function loadNotices() {
      showSpinner();
      onValue(ref(db, "notices"), snap => {
        notices = snap.val() || {};
        renderNotices();
        hideSpinner();
      });
    }

    function renderNotices(filter = "") {
      noticeList.innerHTML = "";
      const filteredNotices = Object.entries(notices)
        .filter(([_, notice]) => notice.title.toLowerCase().includes(filter.toLowerCase()))
        .sort((a, b) => b[1].createdAt - a[1].createdAt);
      if (filteredNotices.length === 0) {
        noticeList.innerHTML = "<p class='text-gray-600'>No notices found.</p>";
        return;
      }
      filteredNotices.forEach(([id, n]) => {
        const expiry = n.expiryDate ? new Date(n.expiryDate).toLocaleDateString() : "-";
        const noticeItem = document.createElement("div");
        noticeItem.className = "bg-gray-50 p-4 rounded-lg shadow hover:shadow-md transition-shadow";
        noticeItem.innerHTML = `
          <h4 class="text-md font-semibold">${n.title}</h4>
          <p class="text-gray-700">${n.content}</p>
          <p class="text-sm text-gray-500 mt-2">Posted on ${new Date(n.createdAt).toLocaleDateString()}
          ${n.expiryDate ? ` | Expires on ${expiry}` : ""}</p>
        `;
        noticeList.appendChild(noticeItem);
      });
    }

    // Load tickets
    function loadTickets() {
      showSpinner();
      onValue(ref(db, "helpdesk"), snap => {
        tickets = snap.val() || {};
        ticketList.innerHTML = "";
        for (const id in tickets) {
          const t = tickets[id];
          if (t.userId === currentUserId) {
            const ticketItem = document.createElement("div");
            ticketItem.className = "bg-gray-50 p-4 rounded-lg shadow hover:shadow-md transition-shadow flex justify-between items-center";
            ticketItem.innerHTML = `
              <div>
                <p class="font-semibold">${t.issue}</p>
                <p class="text-sm text-gray-600">Status: ${t.status} | Priority: ${t.priority}</p>
              </div>
            `;
            ticketList.appendChild(ticketItem);
          }
        }
        hideSpinner();
      });
    }

    // Search handlers
    const searchCourses = debounce(filter => loadCourses(filter), 300);
    courseSearch.addEventListener("input", () => searchCourses(courseSearch.value));
    const searchNotices = debounce(filter => renderNotices(filter), 300);
    noticeSearch.addEventListener("input", () => searchNotices(noticeSearch.value));

    // Authentication check
    onAuthStateChanged(auth, async user => {
      if (!user) {
        alert("Unauthorized. Redirecting...");
        window.location.href = "login.html";
      } else {
        currentUserId = user.uid;
        const userSnap = await get(ref(db, `users/${user.uid}`));
        if (userSnap.val()?.role !== "learner") {
          alert("Access restricted to learners only.");
          await signOut(auth);
          window.location.href = "login.html";
          return;
        }
        loadNotifications();
        loadOverview();
        loadCourses();
        loadAssessments();
        loadCertifications();
        loadNotices();
        loadTickets();
      }
    });

    // Sign out
    document.getElementById("signout-btn").addEventListener("click", async () => {
      try {
        await signOut(auth);
        window.location.href = "login.html";
      } catch (err) {
        console.error("Sign-out failed:", err);
        alert("Failed to sign out. Please try again.");
      }
    });

    // Course and assessment actions
    window.viewCourse = id => {
      alert(`Viewing course: ${courses[id].name}\nContent: ${JSON.stringify(courses[id].content || {}, null, 2)}`);
    };

    window.viewAssessment = id => {
      alert(`Viewing assessment: ${assessments[id].title}\nCourse: ${courses[assessments[id].courseId]?.name || "-"}`);
    };

    window.viewCertificate = id => {
      const cert = certifications[id];
      alert(`Certificate: ${cert.template}\nCourse: ${courses[cert.courseId]?.name || "-"}`);
    };

    // Submit helpdesk ticket
    window.submitTicket = async () => {
      const issue = document.getElementById("ticketIssue").value.trim();
      const priority = document.getElementById("ticketPriority").value;
      if (!issue) {
        alert("Please enter an issue description.");
        return;
      }
      showSpinner();
      try {
        await push(ref(db, "helpdesk"), {
          userId: currentUserId,
          issue,
          priority,
          status: "open",
          createdAt: Date.now(),
          metadata: { tags: ["ticket"], version: "1.0" }
        });
        logAudit(`Submitted helpdesk ticket: ${issue}`);
        document.getElementById("ticketIssue").value = "";
        document.getElementById("ticketPriority").value = "low";
      } catch (err) {
        console.error("Error submitting ticket:", err);
        alert("Failed to submit ticket.");
      }
      hideSpinner();
    };

    // Audit logging
    async function logAudit(action) {
      try {
        await push(ref(db, "audit_logs"), {
          userId: currentUserId,
          action,
          timestamp: Date.now()
        });
      } catch (err) {
        console.error("Error logging audit:", err);
      }
    }
  </script>
</body>
</html>
