<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CETA LMS - Learner Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #f5f8fa;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 1.5rem;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
    }
  </style>
</head>
<body>
  <main class="container">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800">Welcome, <span id="user-email" class="text-twitter-blue"></span></h1>
      <p class="text-gray-600 mt-1">Here's an overview of your learning progress and opportunities.</p>
    </header>

    <section class="mb-10">
      <h2 class="text-2xl font-semibold text-gray-700 mb-4">Enrolled Programs</h2>
      <div id="programs-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        <!-- Program cards inserted here -->
      </div>
    </section>

    <section class="mb-10 max-w-lg">
      <h2 class="text-2xl font-semibold text-gray-700 mb-4">Progress Chart</h2>
      <canvas id="progressChart" width="400" height="250" class="rounded-lg bg-white shadow-md"></canvas>
    </section>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="card">
        <h3 class="text-xl font-semibold mb-2">Grants</h3>
        <p class="text-gray-600">Details about available grants will appear here.</p>
      </div>
      <div class="card">
        <h3 class="text-xl font-semibold mb-2">Bursaries</h3>
        <p class="text-gray-600">Information on bursaries will be displayed here.</p>
      </div>
      <div class="card">
        <h3 class="text-xl font-semibold mb-2">WSP / ATR</h3>
        <p class="text-gray-600">Workplace Skills Plan and Annual Training Report details will be available here.</p>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    // Your Firebase config (replace with your own)
    const firebaseConfig = {
      apiKey: "AIzaSyBOyZ3As4GTuNvjemvPF_SpsC6m6vqtNhc",
      authDomain: "fire-b-a8878.firebaseapp.com",
      databaseURL: "https://fire-b-a8878.firebaseio.com",
      projectId: "fire-b-a8878",
      storageBucket: "fire-b-a8878.firebasestorage.app",
      messagingSenderId: "658673187627",
      appId: "1:658673187627:web:6e4c29af661785f0afa36e",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const userEmailSpan = document.getElementById("user-email");
    const programsList = document.getElementById("programs-list");

    // Dummy enrolled programs data (replace with real data fetch)
    const enrolledPrograms = [
      { id: 1, title: "Construction Safety", description: "Learn about workplace safety protocols." },
      { id: 2, title: "Project Management", description: "Master the essentials of managing construction projects." },
      { id: 3, title: "Sustainable Building", description: "Explore sustainable materials and methods." }
    ];

    // Render program cards
    function renderPrograms() {
      programsList.innerHTML = "";
      enrolledPrograms.forEach(program => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3 class="text-lg font-semibold mb-1">${program.title}</h3>
          <p class="text-gray-600">${program.description}</p>
        `;
        programsList.appendChild(card);
      });
    }

    // Setup Chart.js progress chart with dummy data
    function setupProgressChart() {
      const ctx = document.getElementById('progressChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
          datasets: [{
            label: 'Course Completion %',
            data: [10, 25, 40, 55, 75, 90],
            fill: false,
            borderColor: '#1DA1F2',
            tension: 0.2,
            pointBackgroundColor: '#1DA1F2',
            pointRadius: 5
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              ticks: {
                callback: value => value + '%'
              }
            }
          },
          plugins: {
            legend: {
              labels: { color: '#0F1419', font: { weight: 'bold' } }
            }
          }
        }
      });
    }

    // Auth state check
    onAuthStateChanged(auth, user => {
      if (user) {
        userEmailSpan.textContent = user.email;
        renderPrograms();
        setupProgressChart();
      } else {
        // Redirect to login if not authenticated
        window.location.replace("login.html");
      }
    });
  </script>
</body>
</html>
