<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vine Shot: Counter-Sniper</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@900&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: none; 
        }

        body {
            margin: 0;
            overflow: hidden;
            background: #010a01;
            font-family: 'Share Tech Mono', monospace;
        }

        canvas { display: block; }

        #scope-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 25%, rgba(0,0,0,0.85) 60%, #000 100%);
            pointer-events: none;
            z-index: 20;
        }

        .reticle-v { position: absolute; top: 0; left: 50%; width: 1px; height: 100%; background: rgba(74, 222, 128, 0.3); z-index: 21; pointer-events: none; }
        .reticle-h { position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: rgba(74, 222, 128, 0.3); z-index: 21; pointer-events: none; }

        #ui-container {
            position: absolute;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 30;
            color: #4ade80;
            padding: 40px;
        }

        .status-msg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -150%);
            font-size: 12px; letter-spacing: 4px;
            color: #ef4444; display: none;
        }
    </style>
</head>
<body>

    <div id="scope-overlay"></div>
    <div class="reticle-v"></div>
    <div class="reticle-h"></div>
    
    <div id="ui-container">
        <div style="display:flex; justify-content: space-between;">
            <div>SIGHT: THERMAL_V3<br>THREATS: <span id="score">0</span></div>
            <div style="text-align: right;">WIND: <span id="wind">2.4</span> m/s<br>HUMIDITY: 88%</div>
        </div>
        <div id="target-lock" class="status-msg">TARGET ACQUIRED</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let cw, ch, score = 0, enemy = null, grassBlades = [];
        let windTime = 0, shake = 0, breathing = 0;
        let isDead = false;

        function resize() {
            cw = canvas.width = window.innerWidth;
            ch = canvas.height = window.innerHeight;
            initGrass();
            spawnEnemy();
        }

        function initGrass() {
            grassBlades = [];
            for(let i = 0; i < 100; i++) {
                grassBlades.push({ x: Math.random() * cw, baseY: ch, len: Math.random() * 200 + 150, offset: Math.random() * 10, thickness: Math.random() * 5 + 2 });
            }
        }

        function spawnEnemy() {
            enemy = {
                x: Math.random() * (cw - 200) + 100,
                y: Math.random() * (ch - 300) + 100,
                glintTimer: 0,
                isVisible: false,
                shootTimer: 0,
                threatLevel: 0
            };
        }

        // --- SOUND ENGINE ---
        function playGunshot() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }

        function loop() {
            if (isDead) return;

            ctx.save();
            
            // Breathing Sway
            breathing += 0.02;
            let swayX = Math.sin(breathing) * 15;
            let swayY = Math.cos(breathing * 0.5) * 10;
            
            // Recoil
            if (shake > 0) {
                ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
                shake *= 0.85;
            }
            ctx.translate(swayX, swayY);

            // Background
            ctx.fillStyle = '#010801';
            ctx.fillRect(-100, -100, cw + 200, ch + 200);

            // Enemy Logic
            if (enemy) {
                enemy.glintTimer += 0.016;
                enemy.shootTimer += 0.016;

                // Enemy "Glint" flashes every 2 seconds
                if (Math.sin(enemy.glintTimer * 3) > 0.95) {
                    ctx.shadowBlur = 30;
                    ctx.shadowColor = '#fff';
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, 4, 0, Math.PI*2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }

                // If you take too long (5 seconds), they shoot you
                if (enemy.shootTimer > 5.0) {
                    isDead = true;
                    playGunshot();
                    alert("SNIPER DOWN. FINAL KILLS: " + score);
                    location.reload();
                }
            }

            // Draw Wind-blown Grass (Foreground)
            windTime += 0.03;
            ctx.strokeStyle = '#0a320a';
            ctx.lineCap = 'round';
            grassBlades.forEach(g => {
                let sway = Math.sin(windTime + g.offset) * 20;
                ctx.beginPath();
                ctx.lineWidth = g.thickness;
                ctx.moveTo(g.x, g.baseY);
                ctx.quadraticCurveTo(g.x + sway, g.baseY - g.len/2, g.x + sway*2, g.baseY - g.len);
                ctx.stroke();
            });

            ctx.restore();
            requestAnimationFrame(loop);
        }

        window.addEventListener('mousedown', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            playGunshot();
            shake = 40; // Recoil intensity

            // Adjust click coordinates for scope sway
            let swayX = Math.sin(breathing) * 15;
            let swayY = Math.cos(breathing * 0.5) * 10;
            let hitX = e.clientX - swayX;
            let hitY = e.clientY - swayY;

            let dist = Math.hypot(enemy.x - hitX, enemy.y - hitY);
            if (dist < 40) {
                score++;
                document.getElementById('score').innerText = score;
                spawnEnemy(); // Move to next target
            }
        });

        window.addEventListener('resize', resize);
        resize();
        loop();
    </script>
</body>
</html>
